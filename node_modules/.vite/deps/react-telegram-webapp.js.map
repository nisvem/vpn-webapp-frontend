{
  "version": 3,
  "sources": ["../../react-telegram-webapp/src/TelegramWebAppContext.ts", "../../react-telegram-webapp/src/TelegramWebApp.tsx"],
  "sourcesContent": ["import { createContext, useContext } from \"react\";\nimport { Telegram } from \"./Telegram/Telegram\";\n\nexport type TelegramWebAppModel = {\n  app: Telegram.Unsafe.WebApp;\n  startParam: string | null;\n  isReady: boolean;\n};\n\nexport const TelegramWebAppContext = createContext<TelegramWebAppModel>({} as any);\n\nexport function useStartParam() {\n  const { startParam } = useContext(TelegramWebAppContext);\n  return startParam;\n}\n\nexport function useTelegramWebApp() {\n  const { app } = useContext(TelegramWebAppContext);\n  return app;\n}\n\nexport function useIsTelegramWebAppReady() {\n  const { isReady } = useContext(TelegramWebAppContext);\n  return isReady;\n}\n", "import React from \"react\";\nimport { ComponentType, useEffect, useRef, useState } from \"react\";\nimport { TelegramWebAppModel, TelegramWebAppContext } from \"./TelegramWebAppContext\";\n\ntype TelegramWebAppProps = {\n  children: JSX.Element;\n  validateHash(hash: string): boolean | Promise<boolean>;\n};\n\nexport function TelegramWebApp({ children, validateHash }: TelegramWebAppProps) {\n  const [isReady, setIsReady] = useState(false);\n  const [isValid, setIsValid] = useState(false);\n  const tgWebAppStartParamRef = useRef(new URLSearchParams(window.location.search).get(\"tgWebAppStartParam\"));\n\n  const model: TelegramWebAppModel = {\n    get app() {\n      return (window as any).Telegram?.WebApp;\n    },\n    startParam: tgWebAppStartParamRef.current!,\n    isReady,\n  };\n\n  const onReady = () => {\n    const hashValidation = validateHash(model.app.initData);\n    if (hashValidation instanceof Promise) {\n      hashValidation.then(setIsValid).finally(() => setIsReady(true));\n    } else {\n      setIsValid(hashValidation);\n      setIsReady(true);\n    }\n  };\n\n  useEffect(() => {\n    if (isReady && !isValid) throw new Error(\"Invalid hash\");\n  }, [isReady, isValid]);\n\n  return (\n    <TelegramWebAppScript onLoad={onReady}>\n      <TelegramWebAppContext.Provider value={model}>{children}</TelegramWebAppContext.Provider>\n    </TelegramWebAppScript>\n  );\n}\n\nexport function withTelegramWebApp(Component: ComponentType<any>, contextProps: Omit<TelegramWebAppProps, \"children\">) {\n  return function WithTelegramWebApp(props: any) {\n    return (\n      <TelegramWebApp {...contextProps}>\n        <Component {...props} />\n      </TelegramWebApp>\n    );\n  };\n}\n\nfunction TelegramWebAppScript({ children, onLoad }: { children: JSX.Element; onLoad: () => void }) {\n  // inject on load, remove on unload (using effect), but only once per page\n  useEffect(() => {\n    const tgWebAppScript = document.createElement(\"script\");\n    tgWebAppScript.src = \"https://telegram.org/js/telegram-web-app.js\";\n    tgWebAppScript.onload = onLoad;\n\n    document.head.appendChild(tgWebAppScript);\n    (window as any).__TELEGRAM_WEB_APP_SCRIPT_INJECTED__ = true;\n\n    return () => {\n      document.head.removeChild(tgWebAppScript);\n      (window as any).__TELEGRAM_WEB_APP_SCRIPT_INJECTED__ = false;\n    };\n  }, []);\n\n  return children;\n}\n"],
  "mappings": ";;;;;;;;;IASaA,4BAAwBC,4BAAmC,CAAA,CAAtB;SAElCC,gBAAAA;AACd,MAAA,kBAAuBC,yBAAWH,qBAAD,GAAzBI,aAAR,YAAQA;AACR,SAAOA;AACR;SAEeC,oBAAAA;AACd,MAAA,mBAAgBF,yBAAWH,qBAAD,GAAlBM,MAAR,aAAQA;AACR,SAAOA;AACR;SAEeC,2BAAAA;AACd,MAAA,mBAAoBJ,yBAAWH,qBAAD,GAAtBQ,UAAR,aAAQA;AACR,SAAOA;AACR;SCfeC,eAAAA,MAAAA;MAAiBC,WAAAA,KAAAA,UAAUC,eAAAA,KAAAA;AACzC,MAAA,gBAA8BC,uBAAS,KAAD,GAA/BJ,UAAP,UAAA,CAAA,GAAgBK,aAAhB,UAAA,CAAA;AACA,MAAA,iBAA8BD,uBAAS,KAAD,GAA/BE,UAAP,WAAA,CAAA,GAAgBC,aAAhB,WAAA,CAAA;AACA,MAAMC,4BAAwBC,qBAAO,IAAIC,gBAAgBC,OAAOC,SAASC,MAApC,EAA4CC,IAAI,oBAAhD,CAAD;AAEpC,MAAMC,QAA6B;IACjC,IAAIjB,MAAJ;;AACE,cAAA,mBAAQa,OAAeK,aAAvB,OAAA,SAAQ,iBAAyBC;IAClC;IACDrB,YAAYY,sBAAsBU;IAClClB;EALiC;AAQnC,MAAMmB,UAAU,SAAVA,WAAU;AACd,QAAMC,iBAAiBjB,aAAaY,MAAMjB,IAAIuB,QAAX;AACnC,QAAID,0BAA0BE,SAAS;AACrCF,qBAAeG,KAAKhB,UAApB,EAAA,SAAA,EAAwC,WAAA;AAAA,eAAMF,WAAW,IAAD;MAAhB,CAAxC;IACD,OAAM;AACLE,iBAAWa,cAAD;AACVf,iBAAW,IAAD;IACX;EACF;AAEDmB,8BAAU,WAAA;AACR,QAAIxB,WAAW,CAACM;AAAS,YAAM,IAAImB,MAAM,cAAV;EAChC,GAAE,CAACzB,SAASM,OAAV,CAFM;AAIT,SACEoB,aAAAA,QAAAA,cAACC,sBAAD;IAAsBC,QAAQT;KAC5BO,aAAAA,QAAAA,cAAClC,sBAAsBqC,UAAvB;IAAgCC,OAAOf;KAAQb,QAA/C,CADF;AAIH;AAED,SAAgB6B,mBAAmBC,WAA+BC,cAAAA;AAChE,SAAO,SAASC,mBAAmBC,OAA5B;AACL,WACET,aAAAA,QAAAA,cAACzB,gBAAD,OAAA,OAAA,CAAA,GAAoBgC,YAAAA,GAClBP,aAAAA,QAAAA,cAACM,WAAD,OAAA,OAAA,CAAA,GAAeG,KAAAA,CAAf,CADF;EAIH;AACF;AAED,SAASR,qBAAT,OAAA;MAAgCzB,WAAAA,MAAAA,UAAU0B,SAAAA,MAAAA;AAExCJ,8BAAU,WAAA;AACR,QAAMY,iBAAiBC,SAASC,cAAc,QAAvB;AACvBF,mBAAeG,MAAM;AACrBH,mBAAeI,SAASZ;AAExBS,aAASI,KAAKC,YAAYN,cAA1B;AACCzB,WAAegC,uCAAuC;AAEvD,WAAO,WAAA;AACLN,eAASI,KAAKG,YAAYR,cAA1B;AACCzB,aAAegC,uCAAuC;IACxD;EACF,GAAE,CAAA,CAZM;AAcT,SAAOzC;AACR;",
  "names": ["TelegramWebAppContext", "createContext", "useStartParam", "useContext", "startParam", "useTelegramWebApp", "app", "useIsTelegramWebAppReady", "isReady", "TelegramWebApp", "children", "validateHash", "useState", "setIsReady", "isValid", "setIsValid", "tgWebAppStartParamRef", "useRef", "URLSearchParams", "window", "location", "search", "get", "model", "Telegram", "WebApp", "current", "onReady", "hashValidation", "initData", "Promise", "then", "useEffect", "Error", "React", "TelegramWebAppScript", "onLoad", "Provider", "value", "withTelegramWebApp", "Component", "contextProps", "WithTelegramWebApp", "props", "tgWebAppScript", "document", "createElement", "src", "onload", "head", "appendChild", "__TELEGRAM_WEB_APP_SCRIPT_INJECTED__", "removeChild"]
}
