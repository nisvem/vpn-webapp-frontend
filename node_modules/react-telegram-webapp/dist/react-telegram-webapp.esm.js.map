{"version":3,"file":"react-telegram-webapp.esm.js","sources":["../src/TelegramWebAppContext.ts","../src/TelegramWebApp.tsx"],"sourcesContent":["import { createContext, useContext } from \"react\";\nimport { Telegram } from \"./Telegram/Telegram\";\n\nexport type TelegramWebAppModel = {\n  app: Telegram.Unsafe.WebApp;\n  startParam: string | null;\n  isReady: boolean;\n};\n\nexport const TelegramWebAppContext = createContext<TelegramWebAppModel>({} as any);\n\nexport function useStartParam() {\n  const { startParam } = useContext(TelegramWebAppContext);\n  return startParam;\n}\n\nexport function useTelegramWebApp() {\n  const { app } = useContext(TelegramWebAppContext);\n  return app;\n}\n\nexport function useIsTelegramWebAppReady() {\n  const { isReady } = useContext(TelegramWebAppContext);\n  return isReady;\n}\n","import React from \"react\";\nimport { ComponentType, useEffect, useRef, useState } from \"react\";\nimport { TelegramWebAppModel, TelegramWebAppContext } from \"./TelegramWebAppContext\";\n\ntype TelegramWebAppProps = {\n  children: JSX.Element;\n  validateHash(hash: string): boolean | Promise<boolean>;\n};\n\nexport function TelegramWebApp({ children, validateHash }: TelegramWebAppProps) {\n  const [isReady, setIsReady] = useState(false);\n  const [isValid, setIsValid] = useState(false);\n  const tgWebAppStartParamRef = useRef(new URLSearchParams(window.location.search).get(\"tgWebAppStartParam\"));\n\n  const model: TelegramWebAppModel = {\n    get app() {\n      return (window as any).Telegram?.WebApp;\n    },\n    startParam: tgWebAppStartParamRef.current!,\n    isReady,\n  };\n\n  const onReady = () => {\n    const hashValidation = validateHash(model.app.initData);\n    if (hashValidation instanceof Promise) {\n      hashValidation.then(setIsValid).finally(() => setIsReady(true));\n    } else {\n      setIsValid(hashValidation);\n      setIsReady(true);\n    }\n  };\n\n  useEffect(() => {\n    if (isReady && !isValid) throw new Error(\"Invalid hash\");\n  }, [isReady, isValid]);\n\n  return (\n    <TelegramWebAppScript onLoad={onReady}>\n      <TelegramWebAppContext.Provider value={model}>{children}</TelegramWebAppContext.Provider>\n    </TelegramWebAppScript>\n  );\n}\n\nexport function withTelegramWebApp(Component: ComponentType<any>, contextProps: Omit<TelegramWebAppProps, \"children\">) {\n  return function WithTelegramWebApp(props: any) {\n    return (\n      <TelegramWebApp {...contextProps}>\n        <Component {...props} />\n      </TelegramWebApp>\n    );\n  };\n}\n\nfunction TelegramWebAppScript({ children, onLoad }: { children: JSX.Element; onLoad: () => void }) {\n  // inject on load, remove on unload (using effect), but only once per page\n  useEffect(() => {\n    const tgWebAppScript = document.createElement(\"script\");\n    tgWebAppScript.src = \"https://telegram.org/js/telegram-web-app.js\";\n    tgWebAppScript.onload = onLoad;\n\n    document.head.appendChild(tgWebAppScript);\n    (window as any).__TELEGRAM_WEB_APP_SCRIPT_INJECTED__ = true;\n\n    return () => {\n      document.head.removeChild(tgWebAppScript);\n      (window as any).__TELEGRAM_WEB_APP_SCRIPT_INJECTED__ = false;\n    };\n  }, []);\n\n  return children;\n}\n"],"names":["TelegramWebAppContext","createContext","useStartParam","useContext","startParam","useTelegramWebApp","app","useIsTelegramWebAppReady","isReady","TelegramWebApp","children","validateHash","useState","setIsReady","isValid","setIsValid","tgWebAppStartParamRef","useRef","URLSearchParams","window","location","search","get","model","Telegram","WebApp","current","onReady","hashValidation","initData","Promise","then","useEffect","Error","React","TelegramWebAppScript","onLoad","Provider","value","withTelegramWebApp","Component","contextProps","WithTelegramWebApp","props","tgWebAppScript","document","createElement","src","onload","head","appendChild","__TELEGRAM_WEB_APP_SCRIPT_INJECTED__","removeChild"],"mappings":"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"}