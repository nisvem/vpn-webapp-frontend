{"version":3,"file":"react-telegram-webapp.cjs.production.min.js","sources":["../src/TelegramWebAppContext.ts","../src/TelegramWebApp.tsx"],"sourcesContent":["import { createContext, useContext } from \"react\";\nimport { Telegram } from \"./Telegram/Telegram\";\n\nexport type TelegramWebAppModel = {\n  app: Telegram.Unsafe.WebApp;\n  startParam: string | null;\n  isReady: boolean;\n};\n\nexport const TelegramWebAppContext = createContext<TelegramWebAppModel>({} as any);\n\nexport function useStartParam() {\n  const { startParam } = useContext(TelegramWebAppContext);\n  return startParam;\n}\n\nexport function useTelegramWebApp() {\n  const { app } = useContext(TelegramWebAppContext);\n  return app;\n}\n\nexport function useIsTelegramWebAppReady() {\n  const { isReady } = useContext(TelegramWebAppContext);\n  return isReady;\n}\n","import React from \"react\";\nimport { ComponentType, useEffect, useRef, useState } from \"react\";\nimport { TelegramWebAppModel, TelegramWebAppContext } from \"./TelegramWebAppContext\";\n\ntype TelegramWebAppProps = {\n  children: JSX.Element;\n  validateHash(hash: string): boolean | Promise<boolean>;\n};\n\nexport function TelegramWebApp({ children, validateHash }: TelegramWebAppProps) {\n  const [isReady, setIsReady] = useState(false);\n  const [isValid, setIsValid] = useState(false);\n  const tgWebAppStartParamRef = useRef(new URLSearchParams(window.location.search).get(\"tgWebAppStartParam\"));\n\n  const model: TelegramWebAppModel = {\n    get app() {\n      return (window as any).Telegram?.WebApp;\n    },\n    startParam: tgWebAppStartParamRef.current!,\n    isReady,\n  };\n\n  const onReady = () => {\n    const hashValidation = validateHash(model.app.initData);\n    if (hashValidation instanceof Promise) {\n      hashValidation.then(setIsValid).finally(() => setIsReady(true));\n    } else {\n      setIsValid(hashValidation);\n      setIsReady(true);\n    }\n  };\n\n  useEffect(() => {\n    if (isReady && !isValid) throw new Error(\"Invalid hash\");\n  }, [isReady, isValid]);\n\n  return (\n    <TelegramWebAppScript onLoad={onReady}>\n      <TelegramWebAppContext.Provider value={model}>{children}</TelegramWebAppContext.Provider>\n    </TelegramWebAppScript>\n  );\n}\n\nexport function withTelegramWebApp(Component: ComponentType<any>, contextProps: Omit<TelegramWebAppProps, \"children\">) {\n  return function WithTelegramWebApp(props: any) {\n    return (\n      <TelegramWebApp {...contextProps}>\n        <Component {...props} />\n      </TelegramWebApp>\n    );\n  };\n}\n\nfunction TelegramWebAppScript({ children, onLoad }: { children: JSX.Element; onLoad: () => void }) {\n  // inject on load, remove on unload (using effect), but only once per page\n  useEffect(() => {\n    const tgWebAppScript = document.createElement(\"script\");\n    tgWebAppScript.src = \"https://telegram.org/js/telegram-web-app.js\";\n    tgWebAppScript.onload = onLoad;\n\n    document.head.appendChild(tgWebAppScript);\n    (window as any).__TELEGRAM_WEB_APP_SCRIPT_INJECTED__ = true;\n\n    return () => {\n      document.head.removeChild(tgWebAppScript);\n      (window as any).__TELEGRAM_WEB_APP_SCRIPT_INJECTED__ = false;\n    };\n  }, []);\n\n  return children;\n}\n"],"names":["TelegramWebAppContext","createContext","TelegramWebApp","children","validateHash","useState","isReady","setIsReady","isValid","setIsValid","model","window","Telegram","_window$Telegram","WebApp","startParam","useRef","URLSearchParams","location","search","get","current","useEffect","Error","React","TelegramWebAppScript","onLoad","hashValidation","app","initData","Promise","then","Provider","value","tgWebAppScript","document","createElement","src","onload","head","appendChild","__TELEGRAM_WEB_APP_SCRIPT_INJECTED__","removeChild","useContext","Component","contextProps","props"],"mappings":"oJASaA,EAAwBC,gBAAmC,aCAxDC,SAAiBC,IAAAA,SAAUC,IAAAA,eACXC,YAAS,GAAhCC,OAASC,SACcF,YAAS,GAAhCG,OAASC,OAGVC,EAA6B,iCAEvBC,OAAeC,iBAAfC,EAAyBC,QAEnCC,WAN4BC,SAAO,IAAIC,gBAAgBN,OAAOO,SAASC,QAAQC,IAAI,uBAMjDC,QAClCf,QAAAA,UAaFgB,aAAU,cACJhB,IAAYE,EAAS,MAAM,IAAIe,MAAM,kBACxC,CAACjB,EAASE,IAGXgB,gBAACC,GAAqBC,OAfR,eACRC,EAAiBvB,EAAaM,EAAMkB,IAAIC,UAC1CF,aAA0BG,QAC5BH,EAAeI,KAAKtB,YAAoB,kBAAMF,GAAW,OAEzDE,EAAWkB,GACXpB,GAAW,MAUXiB,gBAACxB,EAAsBgC,UAASC,MAAOvB,GAAQP,IAerD,SAASsB,SAAuBtB,IAAAA,SAAUuB,IAAAA,cAExCJ,aAAU,eACFY,EAAiBC,SAASC,cAAc,iBAC9CF,EAAeG,IAAM,8CACrBH,EAAeI,OAASZ,EAExBS,SAASI,KAAKC,YAAYN,GACzBvB,OAAe8B,sCAAuC,EAEhD,WACLN,SAASI,KAAKG,YAAYR,GACzBvB,OAAe8B,sCAAuC,KAExD,IAEItC,8GD/CawC,aAAW3C,GAAvBM,iDAVeqC,aAAW3C,GAA1Be,wDAKQ4B,aAAW3C,GAAnB4B,yCC0ByBgB,EAA+BC,UACzD,SAA4BC,UAE/BtB,gBAACtB,mBAAmB2C,GAClBrB,gBAACoB,mBAAcE"}